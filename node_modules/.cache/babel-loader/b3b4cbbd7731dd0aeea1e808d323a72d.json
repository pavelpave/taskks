{"ast":null,"code":"var core = require('./core');\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar caller = require('./caller.js');\n\nvar nodeModulesPaths = require('./node-modules-paths.js');\n\nvar normalizeOptions = require('./normalize-options.js');\n\nvar defaultIsFile = function isFile(file) {\n  try {\n    var stat = fs.statSync(file);\n  } catch (e) {\n    if (e && (e.code === 'ENOENT' || e.code === 'ENOTDIR')) return false;\n    throw e;\n  }\n\n  return stat.isFile() || stat.isFIFO();\n};\n\nmodule.exports = function (x, options) {\n  if (typeof x !== 'string') {\n    throw new TypeError('Path must be a string.');\n  }\n\n  var opts = normalizeOptions(x, options);\n  var isFile = opts.isFile || defaultIsFile;\n  var readFileSync = opts.readFileSync || fs.readFileSync;\n  var extensions = opts.extensions || ['.js'];\n  var basedir = opts.basedir || path.dirname(caller());\n  var parent = opts.filename || basedir;\n  opts.paths = opts.paths || []; // ensure that `basedir` is an absolute path at this point, resolving against the process' current working directory\n\n  var absoluteStart = path.resolve(basedir);\n\n  if (opts.preserveSymlinks === false) {\n    try {\n      absoluteStart = fs.realpathSync(absoluteStart);\n    } catch (realPathErr) {\n      if (realPathErr.code !== 'ENOENT') {\n        throw realPathErr;\n      }\n    }\n  }\n\n  if (/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[/\\\\])/.test(x)) {\n    var res = path.resolve(absoluteStart, x);\n    if (x === '..' || x.slice(-1) === '/') res += '/';\n    var m = loadAsFileSync(res) || loadAsDirectorySync(res);\n    if (m) return m;\n  } else {\n    var n = loadNodeModulesSync(x, absoluteStart);\n    if (n) return n;\n  }\n\n  if (core[x]) return x;\n  var err = new Error(\"Cannot find module '\" + x + \"' from '\" + parent + \"'\");\n  err.code = 'MODULE_NOT_FOUND';\n  throw err;\n\n  function loadAsFileSync(x) {\n    var pkg = loadpkg(path.dirname(x));\n\n    if (pkg && pkg.dir && pkg.pkg && opts.pathFilter) {\n      var rfile = path.relative(pkg.dir, x);\n      var r = opts.pathFilter(pkg.pkg, x, rfile);\n\n      if (r) {\n        x = path.resolve(pkg.dir, r); // eslint-disable-line no-param-reassign\n      }\n    }\n\n    if (isFile(x)) {\n      return x;\n    }\n\n    for (var i = 0; i < extensions.length; i++) {\n      var file = x + extensions[i];\n\n      if (isFile(file)) {\n        return file;\n      }\n    }\n  }\n\n  function loadpkg(dir) {\n    if (dir === '' || dir === '/') return;\n\n    if (process.platform === 'win32' && /^\\w:[/\\\\]*$/.test(dir)) {\n      return;\n    }\n\n    if (/[/\\\\]node_modules[/\\\\]*$/.test(dir)) return;\n    var pkgfile = path.join(dir, 'package.json');\n\n    if (!isFile(pkgfile)) {\n      return loadpkg(path.dirname(dir));\n    }\n\n    var body = readFileSync(pkgfile);\n\n    try {\n      var pkg = JSON.parse(body);\n    } catch (jsonErr) {}\n\n    if (pkg && opts.packageFilter) {\n      pkg = opts.packageFilter(pkg, dir);\n    }\n\n    return {\n      pkg: pkg,\n      dir: dir\n    };\n  }\n\n  function loadAsDirectorySync(x) {\n    var pkgfile = path.join(x, '/package.json');\n\n    if (isFile(pkgfile)) {\n      try {\n        var body = readFileSync(pkgfile, 'UTF8');\n        var pkg = JSON.parse(body);\n      } catch (e) {}\n\n      if (opts.packageFilter) {\n        pkg = opts.packageFilter(pkg, x);\n      }\n\n      if (pkg.main) {\n        if (typeof pkg.main !== 'string') {\n          var mainError = new TypeError('package “' + pkg.name + '” `main` must be a string');\n          mainError.code = 'INVALID_PACKAGE_MAIN';\n          throw mainError;\n        }\n\n        if (pkg.main === '.' || pkg.main === './') {\n          pkg.main = 'index';\n        }\n\n        try {\n          var m = loadAsFileSync(path.resolve(x, pkg.main));\n          if (m) return m;\n          var n = loadAsDirectorySync(path.resolve(x, pkg.main));\n          if (n) return n;\n        } catch (e) {}\n      }\n    }\n\n    return loadAsFileSync(path.join(x, '/index'));\n  }\n\n  function loadNodeModulesSync(x, start) {\n    var dirs = nodeModulesPaths(start, opts, x);\n\n    for (var i = 0; i < dirs.length; i++) {\n      var dir = dirs[i];\n      var m = loadAsFileSync(path.join(dir, '/', x));\n      if (m) return m;\n      var n = loadAsDirectorySync(path.join(dir, '/', x));\n      if (n) return n;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}