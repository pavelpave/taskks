{"ast":null,"code":"var Readable = require('readable-stream').Readable;\n\nmodule.exports = function (stream) {\n  var opts = stream._readableState;\n\n  if (typeof stream.read !== 'function') {\n    stream = new Readable(opts).wrap(stream);\n  }\n\n  var ro = new Readable({\n    objectMode: opts && opts.objectMode\n  });\n  var waiting = false;\n  stream.on('readable', function () {\n    if (waiting) {\n      waiting = false;\n\n      ro._read();\n    }\n  });\n\n  ro._read = function () {\n    var buf,\n        reads = 0;\n\n    while ((buf = stream.read()) !== null) {\n      ro.push(buf);\n      reads++;\n    }\n\n    if (reads === 0) waiting = true;\n  };\n\n  stream.once('end', function () {\n    ro.push(null);\n  });\n  stream.on('error', function (err) {\n    ro.emit('error', err);\n  });\n  return ro;\n};","map":null,"metadata":{},"sourceType":"script"}